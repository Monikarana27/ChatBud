<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <meta http-equiv="X-UA-Compatible" content="ie=edge" />
      <link
         rel="shortcut icon"
         href="img/icons8-chat-64.png"
         type="image/x-icon"
      />
      <link
         rel="stylesheet"
         href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
         integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk="
         crossorigin="anonymous"
      />
      <link rel="stylesheet" href="css/style.css" />
      <title>ChatBud - Login & Register</title>
      <style>
         body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
         }
         
         .join-header h1 {
            font-weight: 500 !important;
            font-size: 2.2rem !important;
            color: #1e3a8a !important;
            text-shadow: none;
         }
         
         .auth-tabs {
            display: flex;
            margin-bottom: 25px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
         }
         
         .tab-button {
            flex: 1;
            padding: 14px 20px;
            background: #6c757d;
            color: #ffffff;
            border: none;
            cursor: pointer;
            font-weight: 500;
            font-size: 1rem;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            position: relative;
         }
         
         .tab-button:first-child {
            border-radius: 8px 0 0 8px;
         }
         
         .tab-button:last-child {
            border-radius: 0 8px 8px 0;
         }
         
         .tab-button.active {
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            color: #ffffff;
            box-shadow: 0 2px 8px rgba(30,64,175,0.3);
         }
         
         .tab-button:hover:not(.active) {
            background: #5a6268;
         }
         
         .auth-form {
            display: none;
         }
         
         .auth-form.active {
            display: block;
         }
         
         .form-control {
            margin-bottom: 20px;
         }
         
         .form-control label {
            font-weight: 500 !important;
            font-size: 0.95rem !important;
            color: #4b5563 !important;
            margin-bottom: 8px;
            display: block;
         }
         
         .form-control input {
            font-weight: 400;
            font-size: 1rem;
            padding: 12px 16px;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            background: #ffffff;
            color: #374151;
            transition: all 0.3s ease;
            width: 100%;
            box-sizing: border-box;
         }
         
         .form-control input:focus {
            border-color: #1e40af;
            box-shadow: 0 0 0 3px rgba(30,64,175,0.1);
            outline: none;
         }
         
         .btn {
            font-weight: 500 !important;
            font-size: 1rem !important;
            padding: 14px 32px;
            border-radius: 8px;
            border: none;
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            color: #ffffff;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(30,64,175,0.2);
            width: 100%;
            letter-spacing: 0.5px;
         }
         
         .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(30,64,175,0.3);
            background: linear-gradient(135deg, #1d4ed8, #2563eb);
         }
         
         .error-message {
            color: #dc2626;
            margin: 15px 0;
            text-align: center;
            font-weight: 500;
            font-size: 0.9rem;
            padding: 12px;
            background: rgba(220,38,38,0.08);
            border-radius: 8px;
            border: 1px solid rgba(220,38,38,0.2);
         }
         
         .success-message {
            color: #059669;
            margin: 15px 0;
            text-align: center;
            font-weight: 500;
            font-size: 0.9rem;
            padding: 12px;
            background: rgba(5,150,105,0.08);
            border-radius: 8px;
            border: 1px solid rgba(5,150,105,0.2);
         }
         
         .credit {
            font-weight: 400;
            font-size: 0.9rem;
            color: #6b7280;
         }
         
         .join-container {
            max-width: 450px;
            margin: 80px auto;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.2);
         }
         
         .join-main {
            padding: 30px;
         }
         
         .join-header {
            text-align: center;
            padding: 20px 30px 10px;
         }
      </style>
   </head>
   <body>
      <div class="join-container">
         <header class="join-header">
            <h1>
               <i class="fas fa-comment-dots"></i> ChatBud
            </h1>
         </header>
         <main class="join-main">
            <!-- Auth Tabs -->
            <div class="auth-tabs">
               <button class="tab-button active" onclick="showLoginForm()">Login</button>
               <button class="tab-button" onclick="showRegisterForm()">Register</button>
            </div>

            <!-- Message Display -->
            <div id="message-display"></div>

            <!-- Login Form -->
            <form id="login-form" class="auth-form active">
               <div class="form-control">
                  <label for="login-email">Email or Username</label>
                  <input
                     type="text"
                     name="email"
                     id="login-email"
                     placeholder="Enter email or username..."
                     required
                  />
               </div>
               <div class="form-control">
                  <label for="login-password">Password</label>
                  <input
                     type="password"
                     name="password"
                     id="login-password"
                     placeholder="Enter password..."
                     required
                  />
               </div>
               <button type="submit" class="btn">Login</button>
            </form>

            <!-- Register Form -->
            <form id="register-form" class="auth-form">
               <div class="form-control">
                  <label for="register-username">Username</label>
                  <input
                     type="text"
                     name="username"
                     id="register-username"
                     placeholder="Enter username..."
                     required
                  />
               </div>
               <div class="form-control">
                  <label for="register-email">Email</label>
                  <input
                     type="email"
                     name="email"
                     id="register-email"
                     placeholder="Enter email..."
                     required
                  />
               </div>
               <div class="form-control">
                  <label for="register-password">Password</label>
                  <input
                     type="password"
                     name="password"
                     id="register-password"
                     placeholder="Enter password (min 6 characters)..."
                     required
                     minlength="6"
                  />
               </div>
               <button type="submit" class="btn">Register</button>
            </form>
         </main>
         <footer style="margin-top: 25px">
            <div style="text-align: center" class="credit">
               &copy; Monika
            </div>
         </footer>
      </div>

      <script>
         // Tab switching functions
         function showLoginForm() {
            document.getElementById('login-form').classList.add('active');
            document.getElementById('register-form').classList.remove('active');
            document.querySelectorAll('.tab-button')[0].classList.add('active');
            document.querySelectorAll('.tab-button')[1].classList.remove('active');
            clearMessages();
         }

         function showRegisterForm() {
            document.getElementById('register-form').classList.add('active');
            document.getElementById('login-form').classList.remove('active');
            document.querySelectorAll('.tab-button')[1].classList.add('active');
            document.querySelectorAll('.tab-button')[0].classList.remove('active');
            clearMessages();
         }

         function showMessage(message, type = 'error') {
            const messageDiv = document.getElementById('message-display');
            messageDiv.innerHTML = `<div class="${type}-message">${message}</div>`;
         }

         function clearMessages() {
            document.getElementById('message-display').innerHTML = '';
         }

         // Login form handler
         document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const loginData = Object.fromEntries(formData);

            try {
               const response = await fetch('/auth/login', {
                  method: 'POST',
                  headers: {
                     'Content-Type': 'application/json',
                  },
                  body: JSON.stringify(loginData)
               });

               const result = await response.json();

               if (result.success) {
                  showMessage('Login successful! Redirecting...', 'success');
                  setTimeout(() => {
                     window.location.href = '/chat';
                  }, 1000);
               } else {
                  showMessage(result.message);
               }
            } catch (error) {
               console.error('Login error:', error);
               showMessage('Network error. Please try again.');
            }
         });

         // Register form handler
         document.getElementById('register-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const registerData = Object.fromEntries(formData);

            try {
               const response = await fetch('/auth/register', {
                  method: 'POST',
                  headers: {
                     'Content-Type': 'application/json',
                  },
                  body: JSON.stringify(registerData)
               });

               const result = await response.json();

               if (result.success) {
                  showMessage('Registration successful! Redirecting...', 'success');
                  setTimeout(() => {
                     window.location.href = '/chat';
                  }, 1000);
               } else {
                  showMessage(result.message);
               }
            } catch (error) {
               console.error('Registration error:', error);
               showMessage('Network error. Please try again.');
            }
         });
      </script>
   </body>
</html>